<HTML>

<HEAD>
<TITLE>MACVAX XFC Calls FileIO
</TITLE>
</HEAD>

<BODY>
<!-- --------------------------------------------------------- -->
<A NAME="xfc_INTRODUCTION"></A>
<IMG ALIGN=left SRC="../pics/MacVAX-Icon.GIF">	

<center><h1>MacVAX XFC (system) Calls</h1></center><br>

<p>

<hr><!-- --------------------------------------------------------- -->
<A NAME="xfc_FILE">
<h2>File I/O</h2></A>
<ul>
The following sys routines handle input and output to Macintosh files.
<p>
<A NAME="xfc_8"></A>
<dl>
<dt><B>XFC #OPEN_MAC_FILE (8)</B>
<dd>Puts up a Standard File Open dialogue box, and waits for the user to select a file.  A file 
descriptor, used to refer to the file in all subsequent file i/o calls, is returned in <B>r0</B>.  A 
value of <B>0</B> in <B>r0</B> indicates the Cancel button was clicked, or an error occurred while 
trying to open the file.

<p>
<A NAME="xfc_9"></A>
<dt><B>XFC #CREATE_MAC_FILE (9)</B>
<dd>Puts up a Standard File Put dialogue box, and waits for the user to type in a file name.  
A pointer to a buffer for the new file's name must be passed in <B>r1</B>.  The file descriptor is 
returned in <B>r0</B>.  A value of <B>0</B> in <B>r0</B> indicates the Cancel button was clicked, or an error 
occurred while trying to create the file.

<p>
<A NAME="xfc_10"></A>
<dt><B>XFC #CLOSE_MAC_FILE (10)</B>
<dd>Closes the file described by the file descriptor passed in <B>r0</B>.  If the file was closed 
successfully, <B>0</B> will be returned in <B>r0</B>.  If an error occurred, <B>r0</B> will be set to <B>-1</B>.

<p>
<A NAME="xfc_11"></A>
<dt><B>XFC #READ_MAC_FILE (11)</B>
<dd>Reads the number of bytes indicated by <B>r2</B> into a string buffer pointed to by <B>r1</B>. The file 
to be read from is given by the file descriptor passed in <B>r0</B>.  The current file position is 
shifted by the number of bytes read.  The number of bytes actually read is returned in <B>r2</B>.

<p>
<A NAME="xfc_12"></A>
<dt><B>XFC #WRITE_MAC_FILE (12)</B>
<dd>Writes the number of bytes indicated by <B>r2</B> from a string buffer pointed to by <B>r1</B> at the 
current file position.  The file to be written is selected by the file descriptor passed in <B>r0</B>.  
The current file position is shifted by the number of bytes written.  The number of bytes 
actually written is returned in <B>r2</B>.

<p>
<A NAME="xfc_13"></A>
<dt><B>XFC #SEEK_MAC_FILE (13)</B>
<dd>Moves the current file position to the position passed in <B>r1</B> according to the mode 
passed in <B>r2</B>.  The file is selected using the file descriptor passed in <B>r0</B>.  The mode has 
three possible values:
<ul>
<dl compact>
	<dt>0 <dd>Seek from beginning of file
	<dt>1 <dd>Seek relative to current position
	<dt>2 <dd>Seek from end of file
</dl>
</ul>
On return, <B>r1</B> contains the new current file position.

<A NAME="xfc_FILENAME_STRUCTURE"><h3>Filename Structure</h3></A>
<ul>
The Following <b>File IO</b> calls use a <b>Filename Structure</b>.<br>
A filename structure is a VAX word, to hold a directory reference number, followed by a pascal string for the filename. <br>
ie.
<listing><font size = 3>
	struct
	{
		word directory_refnum;
		pascal_string filename;
	}
</listing></font>
<br>
<dl>
<p>
<A NAME="xfc_29"></A>
<dt><B>XFC #OPEN_NAMED_FILE (29)</B>

<dd><B>OPEN_NAMED_FILE</B> opens a file given its name and directory reference number. The directory reference  number can be obtained from one of <B>GET_CDIR_ID</B>, <B>GET_ADIR_ID</B>, <B>GET_DIR_ID</B>, <B>GET_FILENAME</B> or the <B>FIND_FILE</B> <B>xfc</B>'s. A pointer to a <A href="FileIO.html#xfc_FILENAME_STRUCTURE">filename structure</a> is passed in <B>R1</B>. A file descriptor is returned in <B>R0</B>. A value of <B>0</B> in  <B>R0</B> indicates an error occurred while trying to open the file.

<p>
<A NAME="xfc_30"></A>
<dt><B>XFC #GET_FILENAME_FD (30)</B>
<dd><B>GET_FILENAME</B> returns the directory reference number and name of an open file associated with the given file descriptor. The file descriptor of the open file is passed in <B>R0</B> and a pointer to a <A href="FileIO.html#xfc_FILENAME_STRUCTURE">filename structure</a> to return the result in, should be passed in <B>R1</B>. 

<p>
<A NAME="xfc_31"></A>
<dt><B>XFC #FIND_FILE (31)</B>
<dd><B>FIND_FILE</B> displays a Standard Macintosh File Dialog Box. The user selects a file and the directory reference number and name of the selected file are returned in the <A href="FileIO.html#xfc_FILENAME_STRUCTURE">filename structure</a> pointed to by <B>R1</B>.
<B>R0</B> contains a <B>0</B> if the user selected a file and <B>-1</B> if they cancelled.

<p>
<A NAME="xfc_32"></A>
<dt><B>XFC #GET_DIR_ID (32)</B>
<dd><B>GET_DIR_ID</B>  is currently unimplemented. <br>
<B>GET_DIR_ID</B>  returns the directory reference number of the directory passed as a pascal string pointer in <B>R1</B>. The directory reference number
is returned in <B>R0</B>.

<p>
<A NAME="xfc_33"></A>
<dt><B>XFC #GET_ADIR_ID (33)</B>
<dd><B>GET_ADIR_ID</B> returns the directory reference number of MacVAX's directory (ie the folder the MacVAX application was launched from).
This might be useful to boot code wishing to open a file in the MacVAX folder. The reference number is returned in <B>R0</B>.

<p>
<A NAME="xfc_34"></A>
<dt><B>XFC #GET_CDIR_ID (34)</B>
<dd><B>GET_CDIR_ID</B>  returns the directory reference number of the last folder a file was opened in. The reference number is returned in <B>R0</B>.
</dl>
</ul>
</dl>
</ul>
<!-- --------------------------------------------------------- -->

</BODY>
</HTML>
