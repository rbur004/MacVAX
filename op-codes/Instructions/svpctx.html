<!doctype html public "-//IETF//DTD HTML 2.0//EN">
<HTML>

<HEAD>
<TITLE>SVPCTX Instruction
</TITLE>
</HEAD>

<BODY>
<H2>SVPCTX Instruction</h2>

<table border=0 valign=top cellpadding=5>

<tr>	<td valign=top><b>Purpose:</b></td><td>To save a processes context.</td>

<tr>	<td valign=top><b>Format:</b></td><td>opcode</td>

<tr>	<td valign=top><b>Operation:</b></td><td>
	<dl>
	<dt>If PSL&ltCMD&gt NEQU kernel then
		<dd>Reserved Instruction Fault
	<dt>{Save process general registers in PCB}
	<dt>{Save process IPR page table registers in PCB}
	<dt>{Pop PC and PSL from stack and save in PCB}
	<dt>{Save process IPR stack registers in PCB}
	<dt>{Switch to Interrupt stack}
	</td>

<tr>	<td valign=top><b>Condition<br>Codes:</b></td>
		<td>N &lt- N;<br>
			Z &lt- Z;<br>
			V &lt- V;<br>
			C &lt- C;</td>

<tr>	<td valign=top><B>Exceptions:</B></td><td>Reserved Instruction/td>

<tr>	<td valign=top><b>Opcodes:<b></td>
		<td>
			<table border=0 valign=top cellpadding=2>
			<tr> <td>07</td><tdSVPCTX</td><td>Save Process Context</td>
			</table>
		</td>

<tr>	<td valign=top><b>Description:</b></td>
		<td>The process control block (PCB) is specified by the internal processor register Process Control Block Base (<A HREF="../../VAX-IPR/IPR_PCBB.html#IPL_10">PCBB</A>). The general registers are saved into the PCB. The page table registers describing the process address space are also saved.  The PC and PSL, currently on the top of the stack are popped and stored in the PCB. If the SVCPTX instruction is executed when not on the interrupt stack then execution is switched to the interrupt stack and the IPL is maximized to 1. </td>

<tr>	<td valign=top><b>Notes:</b></td>
		<td><dl compact>
		<dt>1.<dd>A reserved instruction fault occurs if the instruction is executed from any mode other than kernel mode.
		<dt>2.<dd>Some processors keep a copy of the process stack pointers in internal registers. In those processors, SVPCTX saves the internal registers from the PCB. Processors that do not keep a copy of all four stack pointers in internal registers keep only the current access mode register in an internal register. The contents of the internal register are switched with the PCB contents whenever the current access mode field changes. MacVAX does have internal copies of all stack registers.
	<dt>3.<dd>The map, ASTLVL and PME contents of the PCB are not saved because they are rarely changed. Thus not writing them saves overhead.
	<dt>5.<dd>Between the SVPCTX instruction that saves the state for one process and the LDPCTX instruction that loads the state of another, the internal stack pointers may not be referenced by MFPR or MTPR instructions. This implies that interrupt service routines invoked at a priority higher than the lowest one used for context switching must not reference the process stack pointers.</td>
</table>

</BODY>

</HTML>
