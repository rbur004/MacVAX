<!doctype html public "-//IETF//DTD HTML 2.0//EN">
<HTML>

<HEAD>
<TITLE>CHM Instruction
</TITLE>
</HEAD>

<BODY>
<H2>CHM Instructions</h2>

<table border=0 valign=top cellpadding=5>

<tr>	<td valign=top><b>Purpose:</b></td><td>To request services of more priviledged software</td>

<tr>	<td valign=top><b>Format:</b></td><td>opcode code.rw</td>

<tr>	<td valign=top><b>Operation:</b></td><td>
		<dl>
		<dt>If PSL&ltIS&gt EQLU 1 then 
			<dd>HALT; Illegal from Interrupt Stack.
		<dt>if  opcode-mode LSSU PSL&ltCMD&gt then
			<dd>PSL&ltCMD&gt_SP &lt- SP;
			<dd>SP &lt- opcode-mode_SP;
		<dt>-(SP) &lt- PSL;
		<dt>-(SP) &lt- PC;
		<dt>-(SP) &lt- sign-extended code;
		<dt>PSL&ltCM,TP,FPD,DV,FU,IV,T,N,Z,V,C&gt &lt- 0;
		<dt>PSL&ltPMD&gt &lt- PSL&ltCMD&gt;
		<dt>if  opcode-mode LSSU PSL&ltCMD&gt then
			<dd>PSL&ltCMD&gt_SP &lt- opcode-mode;
		<dt>PC &lt- {SCB vector for opcode-mode};
		</dl></td>

<tr>	<td valign=top><b>Condition<br>Codes:</b></td>
		<td>N &lt- 0;<br>
			Z &lt- 0;<br>
			V &lt- 0;<br>
			C &lt- 0;</td>

<tr>	<td valign=top><B>Exceptions:</B></td><td>halt</td>

<tr>	<td valign=top><b>Opcodes:<b></td>
		<td>
			<table border=0 valign=top cellpadding=2>
			<tr> <td>BC</td><td>CHMK</td><td>Change mode to Kernel</td>
			<tr> <td>BD</td><td>CHME</td><td>Change mode to Executive</td>
			<tr> <td>BE</td><td>CHMS</td><td>Change mode to Supervisor</td>
			<tr> <td>BF</td><td>CHMU</td><td>Change mode to User</td>
			</table>
		</td>

<tr>	<td valign=top><b>Description:</b></td>
		<td>Change mode instructions all processes to change their access mode in a controlled manner. The instruction only increases priviledge mode (i.e. decreases the access mode)<p>
A change in mode also results in a change of stack pointers; the old stack pointer is saved, the new pointer is loaded. The PSL, PC and code operand are pushed onto the stack of the new mode. The saved PC addresses the instruction following the CHMx instruction. The code is sign-extended to a longword. After Execution the stack looks like:<p>
<center><table  border=1 cellpadding=2>
<tr><td width=200 align=center>Sign Extended Code</td><td rowspan=3 valign=top>:SP</td>
<tr><td align=center>PC of Instruction After CHMx</td>
<tr><td align=center>Old PSL</td>
</table></center><p>
The destination mode selected by the opcode is used to select a location from the System Control Block. This location addresses the CHMx dispatcher for the specified mode.
		</td>

</table>

</BODY>

</HTML>
