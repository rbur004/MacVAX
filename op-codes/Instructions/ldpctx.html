<!doctype html public "-//IETF//DTD HTML 2.0//EN"><HTML><HEAD><TITLE>LDPCTX Instruction</TITLE></HEAD><BODY><H2>LDPCTX Instruction</h2><table border=0 valign=top cellpadding=5><tr>	<td valign=top><b>Purpose:</b></td><td>To restore a processes context.</td><tr>	<td valign=top><b>Format:</b></td><td>opcode</td><tr>	<td valign=top><b>Operation:</b></td><td>	<dl>	<dt>If PSL&ltCMD&gt NEQU kernel then		<dd>Reserved Instruction Fault	<dt>{Invalidate per-process translation buffer entries}	<dt>{Load process general registers from PCB}	<dt>{Load process IPR stack registers from PCB}	<dt>{Load process IPR page table registers from PCB}	<dt>{Load process ASTLVL and PME from PCB}	<dt>{Switch to kernel stack}	<dt>{Push PSL and PC on stack for REI}	</td><tr>	<td valign=top><b>Condition<br>Codes:</b></td>		<td>N &lt- N;<br>			Z &lt- Z;<br>			V &lt- V;<br>			C &lt- C;</td><tr>	<td valign=top><B>Exceptions:</B></td><td>Reserved Instruction;<br>												Reserved Operand</td><tr>	<td valign=top><b>Opcodes:<b></td>		<td>			<table border=0 valign=top cellpadding=2>			<tr> <td>06</td><td>LDPCTX</td><td>Load Process Context</td>			</table>		</td><tr>	<td valign=top><b>Description:</b></td>		<td>The process control block (PCB) is specified by the internal processor register Process Control Block Base (<A HREF="../../VAX-IPR/IPR_PCBB.html#IPL_10">PCBB</A>). The general registers are loaded from the PCB. The Page Table registers describing the process address space are also loaded and the process entries in the translation buffer are cleared. Execution is switched to the kernel stack. The PC and PSL are copied from the PCB onto the stack, suitable for a subsequent <A HREF="rei.html"><b>REI</b></A> instruction. </td><tr>	<td valign=top><b>Notes:</b></td>		<td><dl compact>		<dt>1.<dd>A reserved operand fault occurs if the contents of page table registers saved in the PCB were invalid.		<dt>2.<dd>A reserved instruction fault occurs if the instruction is executed from any mode other than kernel mode.		<dt>3.<dd>Some processors keep a copy of the process stack pointers in internal registers. In those processors, LDPCTX loads the internal registers from the PCB. Processors that do not keep a copy of all four stack pointers in internal registers keep only the current access mode register in an internal register. The contents of the internal register are switched with the PCB contents whenever the current access mode field changes. MacVAX does have internal copies of all stack registers.		<dt>4.<dd>Between the SVPCTX instruction that saves the state for one process and the LDPCTX instruction that loads the state of another, the internal stack pointers may not be referenced by MFPR or MTPR instructions. This implies that interrupt service routines invoked at a priority higher than the lowest one used for context switching must not reference the process stack pointers.</td></table></BODY></HTML>