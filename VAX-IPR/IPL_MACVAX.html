<html>
<head>
<title>Internal Processor Registers</title>
</head>

<body>

<IMG ALIGN=left SRC="pics/MacVAX-Icon.GIF">	

<center><h1>VAX Internal Processor Registers<br>MacVAX</h1></center><br>

<p>These registers are accessed using the <b>mtpr</b> and <b>mfpr</b> instructions.<p>

<hr><!-- -------------------------------------------------------------- -->
	<dl compact>
<A NAME="IPL_29"></a>
	<dt><b>MVCR
	<dd>0x29</b> The MacVAX Command Register. 	(Read Only)<p>
	<IMG ALIGN=bottom SRC="pics/IPR-generic.GIF">	
	
	<p>Commands from MacVAX to the VAX OS  running on MacVAX
	are placed in this register. The VAX OS may only read this register. 
	Currently The following are known commands.<p>
	<ul><dl compact>
	
		<dt><B>NULL_COMMAND</B>
		<dd><B>0x0</B> Ignore the command.
		<p>
		<dt><B>NEW_PROCESS</B>
		<dd><B>0x1</B> This is sent when the user selects the <B>Load Process</B>
		 menu item.
		<p>
		<dt><B>KILL_PROCESS</B>
		<dd><B>0x2</B> This is sent when the user selects the <B>Terminate 
		Process</B> menu item.
		<p>
		<dt><B>RESET_PROCESS</B>
		<dd><B>0x3</B> This is sent when the user selects the <B>Reset 
		Process</B> menu item.
		<p>
		<dt><B>SHUTDOWN_SYS</B>
		<dd><B>0x4</B> This is sent when the user selects the <B>Shutdown
		 System</B> menu item.
	</dl></ul>
	
<A NAME="IPL_2A"></a>
	<dt><b>MVCS
	<dd>0x2A </b> The MacVAX Command Status Register	(Read/Write)
	<p><IMG ALIGN=bottom SRC="pics/IPR-MVCS.GIF">	
		<ul>
		<B>E</B> = <B>ERR</B> or error bit. 	 (set by hardware, write clears)<br>	
		<B>I</B> = <B>INT</B> or interrupt bit.  (set by hardware, write clears)<br>
		<B>IE</B> = <B>INT_ENB</B> or interrupt enabled bit	(read/write)<br>
		</ul>
	<p>The <B>MVCS</B> is a read/write register that contains control and 
	status information for the MacVAX / System interface.  If  the <B>MVCS</B>
	interrupt enable  bit is set
	 by 	software, an interrupt, at <B>IPL 23</B> through vector 
	<B>V_MACVAX</B>,  (<B>SCBB</B>+0xE0), is generated 	when <B>INT</B>  becomes set.
	 If <B>INT</B>  is already set and the software sets the interrupt 	enable  bit,
	 an interrupt is generated. The <B>Error</B>  bit is set if the <B>INT</B>  
	  bit was 
	 set when MacVAX put a command in the  <B>MVCR</B> (ie. on overflow). 
	 The <B>INT</B>   and <B>Error</B> bits must be cleared, by the interrupt
	 service routine, by writing a <B>1</B> to the bits 	with a <B>mtpr</B>
	 instruction (don’t forget to set the <B>IE</B> bit as writing a <B>0</B>
	 will clear 	this bit).<p>

<A NAME="IPL_2B"></a>
	<dt><b>MVPID
	<dd>0x2B </b> The MacVAX  Process ID				(Read/Write)
	<p><IMG ALIGN=bottom SRC="pics/IPR-generic.GIF">	

	<p>The <B>MVPID</B> holds a process identifier used by MacVAX to match the
	current <B>P0</B> process with its symbol table. The process
	identifier is set by the VAX OS by using the <B>xfc</B>, 
	<B>CREATE_SYS_SYMBOL_TABLE</B>. The OS may 		
	change the current process identifier by writing to the <B>MVPID</B> register 
	with a <B>mtpr</B> or through the <B>xfc</B>, <B>USE_USER_SYMBOL_TABLE</B>. A 
	<B>svpctx</B> will save the contents of this register in the long
	following the <B>PCB</B> (offset 		
	of <B>PCB_PID</B> 	0x60). A <B>ldpctx</B>  will restore the contents of the 		
	<B>MVPID</B> from the long following the <B>PCB</B>. 
	(see also <A HREF="http://www.cs.auckland.ac.nz/references/xfc/System.html"><B>xfc</B> #<B>SYSTEM</B></A>).<p>

<A NAME="IPL_2C"></a>
	<dt><b>MVMEM
	<dd>0x2C </b> MacVAX  Available Memory				(Read Only)
	<p><IMG ALIGN=bottom SRC="pics/IPR-generic.GIF">	

	<p>The <B>MVMEM</B> is a read only register holding the number of bytes of  
	VAX Physical memory allocated by MacVAX at startup. This figure cannot be 
	changed by the user.<p>

<A NAME="IPL_32"></a>
	<dt><b>KFP 
	<dd>0x32 </b> Kernel Frame Pointer			(Read Only)
<A NAME="IPL_33"></a>
	<dt><b>EFP
	<dd>0x33 </b> Executive Frame Pointer			(Read Only)
<A NAME="#IPL_34"></a>
	<dt><b>SFP
	<dd>0x34 </b> Supervisor Frame Pointer			(Read Only)
<A NAME="IPL_35"></a>
	<dt><b>UFP
	<dd>0x35 </b> User Frame Pointer				(Read Only)
<A NAME="IPL_36"></a>
	<dt><b>IFP
	<dd>0x36 </b> Interrupt Frame Pointer			(Read Only)
		<p><IMG ALIGN=bottom SRC="pics/IPR-generic.GIF">
		<p>
		A <b>VAX</b> process has four frame pointers. A normal VAX
		processor does not have these registers as they are not necessary. The 
		frame pointer, (<b>FP</b>), is changed on procedure entry by a
		<B>calls</B> or <B>callg</B> instruction and on procedure exit by 
		a <B>ret</B> instruction.<p>
		
		MacVAX uses these registers to help it display frames in the <b>Stack Window
		</b>. They are not used for any other purpose. They are saved and restored 
		on process context switches at the following offsets off of the <b>PCBB</b>:
		<listing>
			<B>PCB_KFP</B> 	0x64<br>
			<B>PCB_EFP</B> 	0x68<br>
			<B>PCB_SFP</B> 	0x6C <br>
			<B>PCB_UFP</B> 	0x70<br>
		</listing>
		<p>

</body>
</html>
